// Updated User model with better-auth integration
// This merges the existing Catalyst User with better-auth requirements

model User {
  // Better-Auth required fields
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  emailVerified Boolean   @default(false)  // NEW: for email verification
  image         String?                     // NEW: optional profile image
  
  // Existing Catalyst fields
  username      String    @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // BETTER-AUTH Relations
  accounts      account[]                   // NEW: OAuth and password auth
  sessions      session[]                   // NEW: session management

  // Existing Catalyst Relations
  roles         Role[]
  servers       ServerAccess[]
  auditLog      AuditLog[]
  invitesSent   ServerAccessInvite[] @relation("ServerInviteSender")
  alertRules    AlertRule[]
  alerts        Alert[]
}

// MIGRATION NOTES:
// ============================================================
// 1. REMOVED FIELDS: 
//    - password (now stored in account.password)
//
// 2. ADDED FIELDS:
//    - emailVerified: Boolean (default false)
//    - image: String? (optional)
//    - name: String (required by better-auth)
//
// 3. KEEP EXISTING FIELDS:
//    - username (kept for backward compatibility)
//    - email (already there)
//    - All timestamps
//    - All existing relations (roles, servers, audit, alerts)
//
// 4. NEW RELATIONS (for better-auth):
//    - accounts -> account[]
//    - sessions -> session[]
//
// 5. DATA MIGRATION PLAN:
//    a) Add new fields (emailVerified, image, name) to User
//    b) Populate name from username if not set
//    c) Create account records with password from User.password
//    d) Drop User.password after migration
//
// 6. CONSIDERATIONS:
//    - username is kept for backward compatibility with existing app
//    - name is required by better-auth (populate from username initially)
//    - Email verification tracking via emailVerified field
//    - No breaking changes to existing relationships
