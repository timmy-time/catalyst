#!/bin/bash
#
# Pre-commit hook to run cargo fmt and clippy checks
# To install: cp .githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit
# Or: git config core.hooksPath .githooks

set -e

# Check if there are any Rust files staged
RUST_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^catalyst-agent/.*\.rs$' || true)

if [ -z "$RUST_FILES" ]; then
    echo "No Rust files staged, skipping cargo checks"
    exit 0
fi

cd catalyst-agent

echo "Running cargo fmt --check..."
if ! cargo fmt --check; then
    echo ""
    echo "ERROR: Code is not formatted correctly."
    echo "Run 'cargo fmt' to fix formatting issues."
    exit 1
fi

echo "Running cargo clippy..."
if ! cargo clippy -- -D warnings; then
    echo ""
    echo "ERROR: Clippy found issues."
    echo "Fix the clippy warnings above before committing."
    exit 1
fi

echo "All checks passed!"
