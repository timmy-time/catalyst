{
  "id": "minecraft-paper",
  "name": "Minecraft Server (Paper)",
  "description": "High-performance Minecraft server running Paper. Installer prefers MCJARS and falls back to the PaperMC API.",
  "author": "Catalyst Maintainers",
  "version": "latest",
  "image": "eclipse-temurin:21-jre",
  "images": [
    {
      "name": "temurin-25",
      "label": "Eclipse Temurin 25 JRE",
      "image": "eclipse-temurin:25-jre"
    },
    {
      "name": "temurin-21",
      "label": "Eclipse Temurin 21 JRE",
      "image": "eclipse-temurin:21-jre"
    },
    {
      "name": "temurin-17",
      "label": "Eclipse Temurin 17 JRE",
      "image": "eclipse-temurin:17-jre"
    },
    {
      "name": "temurin-11",
      "label": "Eclipse Temurin 11 JRE",
      "image": "eclipse-temurin:11-jre"
    },
    {
      "name": "temurin-8",
      "label": "Eclipse Temurin 8 JRE",
      "image": "eclipse-temurin:8-jre"
    }
  ],
  "defaultImage": "eclipse-temurin:21-jre",
  "installImage": "alpine:3.19",
  "startup": "java -Xms{{MEMORY_XMS}}M -Xmx{{MEMORY}}M -XX:MaxMetaspaceSize=512M -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=compact -XX:ShenandoahUncommitDelay=30000 -XX:ShenandoahAllocationThreshold=15 -XX:ShenandoahGuaranteedGCInterval=30000 -XX:+PerfDisableSharedMem -XX:+DisableExplicitGC -XX:+ParallelRefProcEnabled -XX:ParallelGCThreads=4 -XX:ConcGCThreads=2 -jar paper.jar nogui",
  "stopCommand": "stop",
  "sendSignalTo": "SIGTERM",
  "variables": [
    {
      "name": "MEMORY",
      "description": "Amount of RAM in MB to allocate to the server",
      "default": "1024",
      "required": true,
      "input": "number",
      "rules": [
        "between:512,16384"
      ]
    },
    {
      "name": "MC_VERSION",
      "description": "Minecraft version to install (leave blank for latest)",
      "default": "",
      "required": false,
      "input": "text"
    },
    {
      "name": "PAPER_BUILD",
      "description": "Specific Paper build number (leave blank for latest build of selected version)",
      "default": "",
      "required": false,
      "input": "number"
    },
    {
      "name": "MEMORY_PERCENT",
      "description": "Percent of allocated memory to give the JVM",
      "default": "75",
      "required": false,
      "input": "number",
      "rules": [
        "between:50,95"
      ]
    },
    {
      "name": "MEMORY_XMS_PERCENT",
      "description": "Percent of JVM max heap to use for Xms",
      "default": "50",
      "required": false,
      "input": "number",
      "rules": [
        "between:25,90"
      ]
    },
    {
      "name": "PORT",
      "description": "Server port (both container and host will use this port)",
      "default": "25565",
      "required": true,
      "input": "number",
      "rules": [
        "between:1024,65535"
      ]
    },
    {
      "name": "EULA",
      "description": "Agree to Minecraft EULA",
      "default": "true",
      "required": true,
      "input": "checkbox"
    },
    {
      "name": "DIFFICULTY",
      "description": "Game difficulty level",
      "default": "2",
      "required": false,
      "input": "select",
      "rules": [
        "in:0,1,2,3"
      ]
    },
    {
      "name": "GAMEMODE",
      "description": "Game mode",
      "default": "survival",
      "required": false,
      "input": "select",
      "rules": [
        "in:survival,creative,adventure,spectator"
      ]
    },
    {
      "name": "PVP",
      "description": "Enable PvP",
      "default": "true",
      "required": false,
      "input": "checkbox"
    },
    {
      "name": "LEVEL_NAME",
      "description": "World name",
      "default": "world",
      "required": false,
      "input": "text"
    },
    {
      "name": "LEVEL_SEED",
      "description": "World seed (empty for random)",
      "default": "",
      "required": false,
      "input": "text"
    },
    {
      "name": "LEVEL_TYPE",
      "description": "World type",
      "default": "minecraft:normal",
      "required": false,
      "input": "select",
      "rules": [
        "in:minecraft:normal,minecraft:flat,minecraft:large_biomes,minecraft:amplified"
      ]
    },
    {
      "name": "ONLINE_MODE",
      "description": "Online mode (authentication)",
      "default": "true",
      "required": false,
      "input": "checkbox"
    },
    {
      "name": "WHITE_LIST",
      "description": "Enable whitelist",
      "default": "false",
      "required": false,
      "input": "checkbox"
    },
    {
      "name": "MAX_PLAYERS",
      "description": "Maximum number of players",
      "default": "20",
      "required": false,
      "input": "number",
      "rules": [
        "between:1,255"
      ]
    },
    {
      "name": "MOTD",
      "description": "Message of the day",
      "default": "A Minecraft Server",
      "required": false,
      "input": "text"
    },
    {
      "name": "ENABLE_RCON",
      "description": "Enable RCON remote console",
      "default": "false",
      "required": false,
      "input": "checkbox"
    }
  ],
  "installScript": "#!/bin/sh\nset -e\n\necho '[Catalyst] Starting Minecraft Paper server installation...'\n\nmkdir -p {{SERVER_DIR}}\ncd {{SERVER_DIR}}\n\nMC_VERSION=\"{{MC_VERSION}}\"\nPAPER_BUILD=\"{{PAPER_BUILD}}\"\n\nPAPER_API=\"https://api.papermc.io\"\nMCJARS_API=\"https://mcjars.app/api\"\n\nhttp_get() {\n  url=\"$1\"\n  if command -v curl >/dev/null 2>&1; then\n    curl -fsSL \"$url\"\n  elif command -v wget >/dev/null 2>&1; then\n    wget -qO- \"$url\"\n  else\n    return 127\n  fi\n}\n\ndownload_file() {\n  url=\"$1\"\n  out=\"$2\"\n  if command -v wget >/dev/null 2>&1; then\n    wget -q -O \"$out\" \"$url\"\n  elif command -v curl >/dev/null 2>&1; then\n    curl -fsSL -o \"$out\" \"$url\"\n  else\n    echo '[Catalyst] ERROR: Neither wget nor curl found!'\n    return 127\n  fi\n}\n\njson_first_string_field() {\n  payload=\"$1\"\n  key=\"$2\"\n  printf '%s' \"$payload\" | grep -o \"\\\"$key\\\"[[:space:]]*:[[:space:]]*\\\"[^\\\"]*\\\"\" | head -n1 | sed \"s/^\\\"$key\\\"[[:space:]]*:[[:space:]]*\\\"//;s/\\\"$//\"\n}\n\njson_array_last_string() {\n  payload=\"$1\"\n  key=\"$2\"\n  values=$(printf '%s' \"$payload\" | tr -d '\\n' | sed -n \"s/.*\\\"$key\\\"[[:space:]]*:[[:space:]]*\\[\\([^]]*\\)\\].*/\\1/p\")\n  if [ -n \"$values\" ]; then\n    printf '%s' \"$values\" | tr ',' '\\n' | sed 's/^[[:space:]]*\"//;s/\"[[:space:]]*$//' | tail -n1\n  fi\n}\n\njson_array_last_number() {\n  payload=\"$1\"\n  key=\"$2\"\n  values=$(printf '%s' \"$payload\" | tr -d '\\n' | sed -n \"s/.*\\\"$key\\\"[[:space:]]*:[[:space:]]*\\[\\([^]]*\\)\\].*/\\1/p\")\n  if [ -n \"$values\" ]; then\n    printf '%s' \"$values\" | tr ',' '\\n' | sed 's/[^0-9]//g' | awk 'NF { print }' | tail -n1\n  fi\n}\n\nextract_zip() {\n  file=\"$1\"\n  if command -v unzip >/dev/null 2>&1; then\n    unzip -o \"$file\"\n  elif command -v bsdtar >/dev/null 2>&1; then\n    bsdtar -xf \"$file\"\n  elif command -v python3 >/dev/null 2>&1; then\n    python3 -m zipfile -e \"$file\" .\n  else\n    echo '[Catalyst] ERROR: unzip not available to extract zip archive.'\n    return 1\n  fi\n}\n\nextract_if_zip() {\n  file=\"$1\"\n  case \"$file\" in\n    *.zip)\n      echo '[Catalyst] Detected zip archive, extracting...'\n      extract_zip \"$file\"\n      rm -f \"$file\"\n      ;;\n    *)\n      if command -v file >/dev/null 2>&1 && file \"$file\" 2>/dev/null | grep -qi 'Zip archive data'; then\n        echo '[Catalyst] Detected zip archive by content, extracting...'\n        extract_zip \"$file\"\n        rm -f \"$file\"\n      fi\n      ;;\n  esac\n}\n\nnormalize_paper_jar() {\n  if [ -f paper.jar ]; then\n    return 0\n  fi\n\n  found=$(find . -maxdepth 4 -type f -name 'paper-*.jar' | head -n1 || true)\n  if [ -z \"$found\" ]; then\n    found=$(find . -maxdepth 4 -type f -name '*.jar' | head -n1 || true)\n  fi\n\n  if [ -n \"$found\" ]; then\n    mv -f \"$found\" paper.jar\n    return 0\n  fi\n\n  return 1\n}\n\ntry_install_from_mcjars() {\n  echo '[Catalyst] Attempting MCJARS installer for PAPER...'\n\n  mcjars_payload=''\n  if [ -n \"$MC_VERSION\" ]; then\n    mcjars_payload=$(http_get \"$MCJARS_API/v1/builds/PAPER/$MC_VERSION/latest\" 2>/dev/null || true)\n  else\n    mcjars_payload=$(http_get \"$MCJARS_API/v2/builds/PAPER\" 2>/dev/null || true)\n  fi\n\n  if [ -z \"$mcjars_payload\" ]; then\n    return 1\n  fi\n\n  download_url=''\n  download_name=''\n\n  if command -v jq >/dev/null 2>&1; then\n    if [ -n \"$MC_VERSION\" ]; then\n      download_url=$(printf '%s' \"$mcjars_payload\" | jq -r '.build.jarUrl // .build.zipUrl // (.build.installation[][]? | select(.type==\"download\") | .url) // empty' | head -n1)\n      download_name=$(printf '%s' \"$mcjars_payload\" | jq -r '.build.installation[][]? | select(.type==\"download\") | .file // empty' | head -n1)\n    else\n      latest=$(printf '%s' \"$mcjars_payload\" | jq -c '.builds | to_entries | map(.value.latest) | sort_by(.created // \"\") | last // empty')\n      download_url=$(printf '%s' \"$latest\" | jq -r '.jarUrl // .zipUrl // (.installation[][]? | select(.type==\"download\") | .url) // empty' | head -n1)\n      download_name=$(printf '%s' \"$latest\" | jq -r '.installation[][]? | select(.type==\"download\") | .file // empty' | head -n1)\n    fi\n  else\n    download_url=$(json_first_string_field \"$mcjars_payload\" 'jarUrl')\n    if [ -z \"$download_url\" ]; then\n      download_url=$(json_first_string_field \"$mcjars_payload\" 'zipUrl')\n    fi\n    if [ -z \"$download_url\" ]; then\n      download_url=$(json_first_string_field \"$mcjars_payload\" 'url')\n    fi\n    download_name=$(json_first_string_field \"$mcjars_payload\" 'file')\n  fi\n\n  if [ -z \"$download_url\" ]; then\n    return 1\n  fi\n\n  if [ -z \"$download_name\" ] || [ \"$download_name\" = 'null' ]; then\n    download_name='paper.download'\n  fi\n  download_name=\"${download_name##*/}\"\n\n  if ! download_file \"$download_url\" \"$download_name\"; then\n    return 1\n  fi\n\n  extract_if_zip \"$download_name\"\n\n  if [ -f \"$download_name\" ] && echo \"$download_name\" | grep -Ei '\\.(jar)$' >/dev/null; then\n    mv -f \"$download_name\" paper.jar\n  fi\n\n  normalize_paper_jar\n}\n\ninstall_from_papermc() {\n  echo '[Catalyst] Falling back to PaperMC API installer...'\n\n  project_payload=$(http_get \"$PAPER_API/v2/projects/paper\")\n\n  selected_version=\"$MC_VERSION\"\n  if [ -z \"$selected_version\" ]; then\n    if command -v jq >/dev/null 2>&1; then\n      selected_version=$(printf '%s' \"$project_payload\" | jq -r '.versions | if type==\"array\" and length>0 then .[-1] else empty end')\n    else\n      selected_version=$(json_array_last_string \"$project_payload\" 'versions')\n    fi\n  fi\n\n  if [ -z \"$selected_version\" ]; then\n    echo '[Catalyst] ERROR: Could not determine Paper version.'\n    return 1\n  fi\n\n  echo \"[Catalyst] Using Paper version: $selected_version\"\n\n  version_payload=$(http_get \"$PAPER_API/v2/projects/paper/versions/$selected_version\")\n\n  selected_build=\"$PAPER_BUILD\"\n  if [ -z \"$selected_build\" ]; then\n    if command -v jq >/dev/null 2>&1; then\n      selected_build=$(printf '%s' \"$version_payload\" | jq -r '.builds | if type==\"array\" and length>0 then .[-1] else empty end')\n    else\n      selected_build=$(json_array_last_number \"$version_payload\" 'builds')\n    fi\n  fi\n\n  if [ -z \"$selected_build\" ]; then\n    echo \"[Catalyst] ERROR: Could not determine Paper build for version $selected_version.\"\n    return 1\n  fi\n\n  echo \"[Catalyst] Using Paper build: $selected_build\"\n\n  build_payload=$(http_get \"$PAPER_API/v2/projects/paper/versions/$selected_version/builds/$selected_build\")\n\n  jar_name=''\n  if command -v jq >/dev/null 2>&1; then\n    jar_name=$(printf '%s' \"$build_payload\" | jq -r '.downloads.application.name // empty')\n  else\n    jar_name=$(printf '%s' \"$build_payload\" | grep -o 'paper-[^\"[:space:]]*\\.jar' | head -n1)\n  fi\n\n  if [ -z \"$jar_name\" ]; then\n    jar_name=\"paper-$selected_version-$selected_build.jar\"\n  fi\n\n  download_url=\"$PAPER_API/v2/projects/paper/versions/$selected_version/builds/$selected_build/downloads/$jar_name\"\n  download_file \"$download_url\" \"$jar_name\"\n\n  mv -f \"$jar_name\" paper.jar\n  normalize_paper_jar\n}\n\nif try_install_from_mcjars; then\n  echo '[Catalyst] Installed Paper via MCJARS.'\nelse\n  install_from_papermc\nfi\n\nif [ ! -f paper.jar ]; then\n  echo '[Catalyst] ERROR: Failed to obtain paper.jar.'\n  exit 1\nfi\n\nif [ \"{{EULA}}\" = \"true\" ] || [ \"{{EULA}}\" = \"1\" ]; then\n  echo 'eula=true' > eula.txt\nfi\n\ncat > server.properties << 'PROPS'\nserver-port={{PORT}}\ndifficulty={{DIFFICULTY}}\ngamemode={{GAMEMODE}}\npvp={{PVP}}\nlevel-name={{LEVEL_NAME}}\nlevel-seed={{LEVEL_SEED}}\nlevel-type={{LEVEL_TYPE}}\nonline-mode={{ONLINE_MODE}}\nwhite-list={{WHITE_LIST}}\nmax-players={{MAX_PLAYERS}}\nmotd={{MOTD}}\nenable-rcon={{ENABLE_RCON}}\nPROPS\n\necho '[Catalyst] Server configuration created'\necho '[Catalyst] Installation complete!'\n",
  "supportedPorts": [
    25565
  ],
  "allocatedMemoryMb": 1024,
  "allocatedCpuCores": 2,
  "features": {
    "restartOnExit": true,
    "maxInstances": 10,
    "modManager": {
      "providers": [
        "curseforge",
        "modrinth"
      ],
      "paths": {
        "mods": "/mods",
        "datapacks": "/world/datapacks",
        "modpacks": "/modpacks"
      }
    },
    "pluginManager": {
      "providers": [
        "modrinth",
        "spigot",
        "paper"
      ],
      "paths": {
        "plugins": "/plugins"
      }
    }
  }
}
