{
  "id": "mcjars-forge",
  "name": "Minecraft Server (Forge)",
  "description": "The original Minecraft modding platform.",
  "author": "MCJARS",
  "version": "61.0.8",
  "image": "eclipse-temurin:21-jre",
  "images": [
    {
      "name": "temurin-25",
      "label": "Eclipse Temurin 25 JRE",
      "image": "eclipse-temurin:25-jre"
    },
    {
      "name": "temurin-21",
      "label": "Eclipse Temurin 21 JRE",
      "image": "eclipse-temurin:21-jre"
    },
    {
      "name": "temurin-17",
      "label": "Eclipse Temurin 17 JRE",
      "image": "eclipse-temurin:17-jre"
    },
    {
      "name": "temurin-11",
      "label": "Eclipse Temurin 11 JRE",
      "image": "eclipse-temurin:11-jre"
    },
    {
      "name": "temurin-8",
      "label": "Eclipse Temurin 8 JRE",
      "image": "eclipse-temurin:8-jre"
    }
  ],
  "defaultImage": "eclipse-temurin:21-jre",
  "installImage": "alpine:3.19",
  "startup": "java -Xms{{MEMORY_XMS}}M -Xmx{{MEMORY}}M -jar server.jar nogui",
  "stopCommand": "stop",
  "sendSignalTo": "SIGTERM",
  "variables": [
    {
      "name": "TYPE",
      "description": "MCJARS server type",
      "default": "FORGE",
      "required": true,
      "input": "text"
    },
    {
      "name": "MC_VERSION",
      "description": "Minecraft version (leave blank for latest)",
      "default": "",
      "required": false,
      "input": "text"
    },
    {
      "name": "MEMORY",
      "description": "Amount of RAM in MB to allocate to the server",
      "default": "1024",
      "required": true,
      "input": "number"
    },
    {
      "name": "PORT",
      "description": "Server port (both container and host will use this port)",
      "default": "25565",
      "required": true,
      "input": "number",
      "rules": [
        "between:1024,65535"
      ]
    },
    {
      "name": "EULA",
      "description": "Agree to Minecraft EULA",
      "default": "true",
      "required": true,
      "input": "checkbox"
    }
  ],
  "installScript": "#!/bin/sh\nset -e\n\necho '[Catalyst] Installing MCJARS type: {{TYPE}} (mc version: {{MC_VERSION:-latest}})'\n\nmkdir -p {{SERVER_DIR}}\ncd {{SERVER_DIR}}\n\nTYPE=\"{{TYPE}}\"\nMC_VERSION=\"{{MC_VERSION}}\"\n\nAPI_BASE=\"https://mcjars.app/api\"\nBUILD_JSON=\"\"\nlatest=\"\"\n\nif [ -n \"$MC_VERSION\" ]; then\n  BUILD_JSON=$(curl -sS \"$API_BASE/v1/builds/$TYPE/$MC_VERSION/latest\")\nelse\n  BUILD_JSON=$(curl -sS \"$API_BASE/v2/builds/$TYPE\")\nfi\n\nget_json_field() {\n  printf '%s' \"$1\" | grep -o \"\"$2\":\"[^\"]*\" | head -n1 | sed \"s/.*\"$2\":\"//;s/\"$//\"\n}\n\njarUrl=\"\"\nzipUrl=\"\"\ninstUrl=\"\"\ninstFile=\"\"\n\nif command -v jq >/dev/null 2>&1; then\n  if [ -n \"$MC_VERSION\" ]; then\n    jarUrl=$(printf '%s' \"$BUILD_JSON\" | jq -r '.build.jarUrl // empty')\n    zipUrl=$(printf '%s' \"$BUILD_JSON\" | jq -r '.build.zipUrl // empty')\n    instUrl=$(printf '%s' \"$BUILD_JSON\" | jq -r '.build.installation[][]? | select(.type==\"download\") | .url' | head -n1)\n    instFile=$(printf '%s' \"$BUILD_JSON\" | jq -r '.build.installation[][]? | select(.type==\"download\") | .file' | head -n1)\n  else\n    latest=$(printf '%s' \"$BUILD_JSON\" | jq -c '.builds | to_entries | map(.value.latest) | sort_by(.created // \"\") | last')\n    jarUrl=$(printf '%s' \"$latest\" | jq -r '.jarUrl // empty')\n    zipUrl=$(printf '%s' \"$latest\" | jq -r '.zipUrl // empty')\n    instUrl=$(printf '%s' \"$latest\" | jq -r '.installation[][]? | select(.type==\"download\") | .url' | head -n1)\n    instFile=$(printf '%s' \"$latest\" | jq -r '.installation[][]? | select(.type==\"download\") | .file' | head -n1)\n  fi\nelse\n  jarUrl=$(get_json_field \"$BUILD_JSON\" jarUrl)\n  zipUrl=$(get_json_field \"$BUILD_JSON\" zipUrl)\n  instUrl=$(get_json_field \"$BUILD_JSON\" url)\n  instFile=$(get_json_field \"$BUILD_JSON\" file)\nfi\n\nextract_zip() {\n  if command -v unzip >/dev/null 2>&1; then\n    unzip -o \"$1\"\n  elif command -v bsdtar >/dev/null 2>&1; then\n    bsdtar -xf \"$1\"\n  elif command -v python3 >/dev/null 2>&1; then\n    python3 -m zipfile -e \"$1\" .\n  else\n    echo '[Catalyst] ERROR: unzip not available to extract zip archive.'\n    exit 1\n  fi\n}\n\ndownload_and_extract() {\n  url=\"$1\"\n  file=\"$2\"\n  if [ -z \"$file\" ] || [ \"$file\" = \"null\" ]; then\n    file=\"server.download\"\n  fi\n  if command -v wget >/dev/null 2>&1; then\n    wget -q -O \"$file\" \"$url\"\n  elif command -v curl >/dev/null 2>&1; then\n    curl -sL -o \"$file\" \"$url\"\n  else\n    echo '[Catalyst] ERROR: Neither wget nor curl found!'\n    exit 1\n  fi\n  if [ ! -f \"$file\" ]; then\n    echo \"[Catalyst] ERROR: Failed to download from $url\"\n    exit 1\n  fi\n  if echo \"$url\" | grep -Ei '\\.zip($|\\?|#)' >/dev/null || echo \"$file\" | grep -Ei '\\.zip$' >/dev/null; then\n    echo '[Catalyst] Detected zip archive, extracting...'\n    extract_zip \"$file\"\n    rm -f \"$file\"\n  else\n    if file \"$file\" | grep -qi 'Zip archive data'; then\n      echo '[Catalyst] Detected zip archive by content, extracting...'\n      extract_zip \"$file\"\n      rm -f \"$file\"\n    fi\n  fi\n}\n\ndownloaded_any=false\nif command -v jq >/dev/null 2>&1; then\n  if [ -n \"$MC_VERSION\" ]; then\n    step_list=$(printf '%s' \"$BUILD_JSON\" | jq -r '.build.installation[][]? | select(.type==\"download\") | \"\\(.url)|\\(.file)\"')\n  else\n    step_list=$(printf '%s' \"$latest\" | jq -r '.installation[][]? | select(.type==\"download\") | \"\\(.url)|\\(.file)\"')\n  fi\n  if [ -n \"$step_list\" ]; then\n    downloaded_any=true\n    echo \"$step_list\" | while IFS='|' read -r step_url step_file; do\n      if [ -n \"$step_url\" ]; then\n        download_and_extract \"$step_url\" \"$step_file\"\n      fi\n    done\n  fi\nfi\n\nFNAME=\"server.download\"\nif [ \"$downloaded_any\" != \"true\" ]; then\n  DOWNLOAD_URL=\"$jarUrl\"\n  if [ -z \"$DOWNLOAD_URL\" ]; then\n    DOWNLOAD_URL=\"$zipUrl\"\n  fi\n  if [ -z \"$DOWNLOAD_URL\" ] && [ -n \"$instUrl\" ]; then\n    DOWNLOAD_URL=\"$instUrl\"\n  fi\n\n  if [ -z \"$DOWNLOAD_URL\" ]; then\n    echo \"[Catalyst] ERROR: Could not find a download URL for type $TYPE\"\n    exit 1\n  fi\n\n  if [ -n \"$instFile\" ]; then\n    FNAME=\"$instFile\"\n  fi\n\n  download_and_extract \"$DOWNLOAD_URL\" \"$FNAME\"\nfi\n\nif [ -f \"$FNAME\" ] && echo \"$FNAME\" | grep -Ei '\\.jar$' >/dev/null; then\n  mv -f \"$FNAME\" server.jar\nfi\n\nif [ ! -f server.jar ]; then\n  JAR=$(find . -maxdepth 4 -type f \\( -iname '*server*.jar' -o -iname '*.jar' \\) | head -n1 || true)\n  if [ -n \"$JAR\" ]; then\n    mv -f \"$JAR\" server.jar\n  fi\nfi\n\nif [ ! -f server.jar ]; then\n  echo '[Catalyst] ERROR: Failed to obtain server.jar after extraction.'\n  exit 1\nfi\n\nif [ \"{{EULA}}\" = \"true\" ] || [ \"{{EULA}}\" = \"1\" ]; then\n  echo 'eula=true' > eula.txt\nfi\n\ncat > server.properties << 'PROPS'\nserver-port={{PORT}}\nmax-players=20\nPROPS\n\necho '[Catalyst] Installation complete!'\n",
  "supportedPorts": [
    25565
  ],
  "allocatedMemoryMb": 1024,
  "allocatedCpuCores": 2,
  "features": {
    "restartOnExit": true,
        "modManager": {
      "providers": ["curseforge", "modrinth"],
      "paths": {
        "mods": "/mods",
        "datapacks": "/world/datapacks",
        "modpacks": "/modpacks"
      }
    }
  }

}
